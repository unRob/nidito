[Interface]
Address = {{ network.range | ipaddr('next_usable') }}
PrivateKey = {{ network.key }}
ListenPort = {{ network.port }}
DNS = {{ dns_servers | join(",") }}

PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o {{ network.interface }} -j MASQUERADE; iptables -A FORWARD -i %i -o {{ network.interface }} -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT; iptables -A FORWARD -i {{ network.interface }} -o %i -j ACCEPT
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o {{ network.interface }} -j MASQUERADE

{% for client in network.clients %}
[Peer]
PublicKey = {{ client.public }}
AllowedIPs = {{ network.range | ipmath(2+loop.index) }}/32
{% endfor %}
